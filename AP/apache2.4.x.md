# Apache HTTP Server 2.4.37 から 2.4.63 への主な変更点

  1. バージョン間の主な変更点（仕様、挙動の違い）
  2. デフォルト値が変更されたディレクティブ（設定項目）の一覧

## コア (Core) の主な変更点

* **UNCパスの制限:** Windows環境でのUNCパスアクセスに対するセキュリティ強化が行われ、**UNCList**という新ディレクティブが追加された。既存の設定でUNCパス (`\\\\SERVER\\Share` 形式) を使用している場合、リクエスト処理中にアクセスを許可するにはUNCListで明示的に許可する必要がある。
* **URL中の連続スラッシュの制御:** 複数の連続した「/」をデフォルトで1つにマージする動作を**MergeSlashes**ディレクティブでオン/オフできるようになった（デフォルトは従来通りオン、`MergeSlashes Off`で無効化可能）。
* **ログ出力の改善:** Linux環境でエラーログにスレッドの実ID (TID) を記録するようになった。また、`-DDUMP_INCLUDES` オプションを`apachectl configtest`に指定すると、`Include/IncludeOptional`で読み込まれる設定ファイルのツリー構造を表示できるようになった。
* **IPv6リンクローカルアドレス対応:** ListenやVirtualHostディレクティブで、IPv6リンクローカルアドレスのゾーンID（スコープ）指定に対応した（APR 1.7.x以上が必要）。
* **その他:** HTTPレスポンスコード501および414に対するカスタムErrorDocumentのサポート、正規表現に関する新ディレクティブ**RegexDefaultOptions**の追加（改行を含むマッチング挙動の制御）など、細かな機能追加・改善が行われている。

## 標準モジュールの主な変更点

### mod\_ssl の変更点

* **TLS 1.3 のサポート:** OpenSSL 1.1.1 への対応に伴い TLSv1.3 がサポートされた。TLS 1.3 特有の動作変更があり、従来の`SSLCipherSuite`はTLS 1.3の暗号には適用されず、バーチャルホスト単位で新たに設定する形となっている。
* **OpenSSL 3 への対応:** OpenSSL 3系ライブラリとの互換性向上のため内部実装が更新された。例えば、OpenSSLのENGINE API非対応ビルド時の挙動改善（`SSLCryptoDevice builtin`の許容）や、OpenSSL 3で廃止予定のAPI呼び出しの調整が行われている。OpenSSL 3利用時には一部ログメッセージ（unexpected EOFエラーなど）が抑制されるよう修正されている。
* **プロキシ経由のSSL設定:** `<Proxy>`セクション内で`SSLProxyProtocol`や`SSLProxyCipherSuite`等の**SSLProxy系ディレクティブ**を使用可能になり、バックエンドごとに異なるTLS設定を適用できるようになった。これにより、プロキシ先サーバー毎にTLSプロトコルや暗号スイートを細かく指定できる。
* **その他の改善:** クライアントからの再交渉要求をコネクション切断ではなくTLS Alertで拒否するよう変更、OCSPステープリング有効時にレスポンダーURLが無い証明書で発生するログレベルの調整、PKCS#11デバイスから証明書を読み込む際の不具合修正など、多数のバグ修正・挙動改善が含まれている。

### mod\_proxy の変更点

* **DNSキャッシュ制御:**  逆引きプロキシ／フォワードプロキシ共通で、バックエンドアドレスのDNS解決結果をキャッシュする期間を指定できる**addressTTL**パラメータが追加された。デフォルトは`-1`（Apache再起動まで無期限）で、適切に設定することでDNS変更への追従や不要な再解決の抑制が可能となる。
* **ProxyRemote に認証情報指定:** 上位プロキシサーバー経由の通信時（ProxyRemote）に、基本認証のクレデンシャルを指定する機能が追加された。これにより、ファイアウォール内のフォワードプロキシなど認証が必要なプロキシをチェインする場合に、Apache側から認証情報を提供できるようになっている。
* **ワーカー名の長さ制限緩和:** プロキシのワーカー名（メンバ名やバランサークラスタ名）の最大長が拡張され、従来より長い識別子を使用できるようになった。長いホスト名や識別子を持つバックエンドシステムに対応しやすくなっている。
* **タイムアウト動作の改善:** WebSocketやCONNECTトンネル使用時のタイムアウト処理が見直され、フロントエンドとバックエンド双方のタイムアウト値の**長い方**を適用するように変更された。これにより、従来のように最短のタイムアウトで切断されてしまうリスクが軽減され、バックエンドの要求に応じた適切なタイムアウトで接続を維持できる。
* **その他の変更:** `ProxyPassMatch`でホスト名やポートに正規表現バックリファレンスを用いた場合、自動接続再利用オプション(enablereuse)を無効にして警告する処理の追加、`ProxyPassReverse`による相対URL書き換えの不具合修正、グローバル定義バランサに対するProxyPass設定のオプション引継ぎ対応など、プロキシ挙動の信頼性向上が図られている。

### mod\_proxy\_ajp (Tomcat連携) の変更点

* **AJPコネクタのセキュリティ強化:** Tomcat AJPコネクタとの連携において、**secret**パラメータ（共有シークレット）のサポートが追加された。Apache側のプロキシワーカーに`secret=...`を設定することで、Tomcat側の`secretRequired`オプション有効時に期待されるAJP13のシークレット認証に対応できるようになっている。
* **ヘッダ数不正時のエラー処理:** バックエンドのAJPサーバーから不正なヘッダ数が送信された場合にエラーとして検知・報告するようになった。これにより、異常なレスポンスに起因するプロキシ側の処理問題を早期に察知できる。
* **デフォルトポート処理の修正:** `ProxyPass` や `<Proxy>`設定でAJPプロトコルを使用する際、ポート番号省略時に正しく既定ポート(8009)を扱うよう内部動作が修正された。この変更により、設定上ポートを省略した場合でも期待通り8009が用いられる。
* **HTTPリクエストスマグリング対策:** mod\_proxy\_ajp におけるリクエストスマグリング脆弱性が複数修正された。HTTPヘッダの解釈不一致を突いた攻撃手法に対し、Apache 2.4.55以降では不正なリクエストを検出して遮断する改善が加えられている。これらにより、AJP経由のリクエスト処理の安全性が向上している。

---

## デフォルト値が変更されたディレクティブ一覧

2.4.37から2.4.63の間でデフォルト値に変更があった主なディレクティブは以下の通りです（モジュール別）。標準モジュール（mod\_ssl, mod\_proxy）およびmod\_proxy\_ajpでは当該期間中にデフォルト値の変更はありません。

### Core

| ディレクティブ              | 旧デフォルト値 | 新デフォルト値        |
| -------------------- | ------- | -------------- |
| **LimitRequestBody** | 0 (無制限) | 1 GB ※2.4.53以降 |

※LimitRequestBodyはApache 2.4.53でデフォルト値が「無制限（0）」から「1ギガバイト上限」に変更されている。これにより、特に明示設定しない場合でも1GBを超えるリクエストボディは受理されなくなった点に注意が必要である。なお、mod\_sslやmod\_proxy、mod\_proxy\_ajpにはデフォルト値の変更は確認されていない。例えば、`SSLProtocol`や`ProxyRequests`といった主要な設定のデフォルトは2.4.37当時から変わっていない。
